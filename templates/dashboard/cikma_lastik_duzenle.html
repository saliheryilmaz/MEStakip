{% extends 'base.html' %}
{% load static %}
{% load turkish_format %}

{% block title %}Çıkma Lastik Düzenle - Mestakip{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h3 mb-0">Çıkma Lastik Düzenle</h1>
        <p class="text-muted mb-0">Çıkma lastik kaydını düzenleyin</p>
    </div>
    <div class="d-flex gap-2">
        <a href="{% url 'dashboard:cikma_lastikler' %}" class="btn btn-secondary">
            <i class="bi bi-arrow-left me-1"></i>
            Geri Dön
        </a>
    </div>
</div>

<!-- Edit Form -->
<div class="card">
    <div class="card-header bg-warning text-dark">
        <h5 class="card-title mb-0">
            <i class="bi bi-pencil me-2"></i>
            Çıkma Lastik Bilgilerini Düzenle
        </h5>
    </div>
    <div class="card-body">
        <form method="post">
            {% csrf_token %}
            <div class="row g-3">
                <!-- Lastik Bilgileri -->
                <div class="col-12">
                    <h6 class="text-primary border-bottom pb-2 mb-3">Lastik Bilgileri</h6>
                </div>
                <div class="col-md-6">
                    <label for="marka" class="form-label">Marka *</label>
                    <input type="text" class="form-control" id="marka" name="marka" value="{{ lastik.marka }}" required>
                </div>
                <div class="col-md-6">
                    <label for="model" class="form-label">Model</label>
                    <input type="text" class="form-control" id="model" name="model" value="{{ lastik.model|default:'' }}" placeholder="Lastik modeli">
                </div>
                <div class="col-md-6">
                    <label for="ebat" class="form-label">Ebat *</label>
                    <input type="text" class="form-control" id="ebat" name="ebat" value="{{ lastik.ebat }}" placeholder="205/55R16" required>
                </div>
                <div class="col-md-6">
                    <label for="mevsim" class="form-label">Mevsim *</label>
                    <select class="form-select" id="mevsim" name="mevsim" required>
                        <option value="">Seçiniz</option>
                        {% for value, label in mevsim_choices %}
                        <option value="{{ value }}" {% if lastik.mevsim == value %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="adet" class="form-label">Adet *</label>
                    <input type="number" class="form-control" id="adet" name="adet" min="1" value="{{ lastik.adet }}" required>
                </div>
                
                <!-- Durum ve Kalite -->
                <div class="col-12">
                    <h6 class="text-primary border-bottom pb-2 mb-3 mt-3">Durum ve Kalite</h6>
                </div>
                <div class="col-md-3">
                    <label for="durum" class="form-label">Durum</label>
                    <select class="form-select" id="durum" name="durum">
                        <option value="depolandi" {% if lastik.durum == 'depolandi' %}selected{% endif %}>Depolandı</option>
                        <option value="satildi" {% if lastik.durum == 'satildi' %}selected{% endif %}>Satıldı</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="dis_derinligi" class="form-label">Diş Derinliği (mm)</label>
                    <input type="text" class="form-control" id="dis_derinligi" name="dis_derinligi" value="{{ lastik.diş_derinligi|default:'' }}" placeholder="3-4 mm">
                </div>
                <div class="col-md-3">
                    <label for="kalite_notu" class="form-label">Kalite (1-5)</label>
                    <input type="number" class="form-control" id="kalite_notu" name="kalite_notu" min="1" max="5" value="{{ lastik.kalite_notu|default:'' }}">
                </div>
                <div class="col-md-3">
                    <label for="tahmini_deger" class="form-label">Tahmini Değer (₺)</label>
                    <input type="number" class="form-control" id="tahmini_deger" name="tahmini_deger" step="0.01" min="0" value="{{ lastik.tahmini_deger|default:'' }}">
                </div>
                
                <!-- Satış Bilgileri - Sadece durum "satildi" ise göster -->
                <div class="col-md-3" id="satis_fiyati_field" style="display: none;">
                    <label for="satis_fiyati" class="form-label">Satış Fiyatı (₺)</label>
                    <input type="number" class="form-control" id="satis_fiyati" name="satis_fiyati" step="0.01" min="0" value="{{ lastik.satis_fiyati|default:'' }}">
                </div>
                <div class="col-md-3" id="satis_tarihi_field" style="display: none;">
                    <label for="satis_tarihi" class="form-label">Satış Tarihi</label>
                    <input type="date" class="form-control" id="satis_tarihi" name="satis_tarihi" value="{{ lastik.satis_tarihi|date:'Y-m-d' }}">
                </div>
                <div class="col-md-6">
                    <label for="hasar_durumu" class="form-label">Hasar Durumu</label>
                    <textarea class="form-control" id="hasar_durumu" name="hasar_durumu" rows="2" placeholder="Yan duvar çatlağı, onarım izi vb.">{{ lastik.hasar_durumu|default:'' }}</textarea>
                </div>
                <div class="col-md-6">
                    <label for="depo_konumu" class="form-label">Depo Konumu</label>
                    <input type="text" class="form-control" id="depo_konumu" name="depo_konumu" value="{{ lastik.depo_konumu|default:'' }}" placeholder="Raf A-1, Saha 2 vb.">
                </div>
                
                <!-- Ek Bilgiler -->
                <div class="col-12">
                    <h6 class="text-primary border-bottom pb-2 mb-3 mt-3">Ek Bilgiler</h6>
                </div>
                <div class="col-md-6">
                    <label for="cikis_tarihi" class="form-label">Çıkış Tarihi</label>
                    <input type="date" class="form-control" id="cikis_tarihi" name="cikis_tarihi" value="{{ lastik.cikis_tarihi|date:'Y-m-d' }}">
                </div>
                <div class="col-12">
                    <label for="aciklama" class="form-label">Açıklama</label>
                    <textarea class="form-control" id="aciklama" name="aciklama" rows="3" placeholder="Ek notlar, özel durumlar vb.">{{ lastik.aciklama|default:'' }}</textarea>
                </div>
            </div>
            
            <div class="d-flex justify-content-end gap-2 mt-4">
                <a href="{% url 'dashboard:cikma_lastikler' %}" class="btn btn-secondary">
                    <i class="bi bi-x-lg me-1"></i>
                    İptal
                </a>
                <button type="submit" class="btn btn-warning">
                    <i class="bi bi-check-lg me-1"></i>
                    Güncelle
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Kayıt Bilgileri -->
<div class="card mt-4">
    <div class="card-header">
        <h6 class="card-title mb-0">Kayıt Bilgileri</h6>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-4">
                <strong>Kayıt ID:</strong> #{{ lastik.id }}
            </div>
            <div class="col-md-4">
                <strong>Oluşturulma:</strong> {{ lastik.olusturma_tarihi|date:"d.m.Y H:i" }}
            </div>
            <div class="col-md-4">
                <strong>Son Güncelleme:</strong> {{ lastik.guncelleme_tarihi|date:"d.m.Y H:i" }}
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const durumSelect = document.getElementById('durum');
    const satisFiyatiField = document.getElementById('satis_fiyati_field');
    const satisTarihiField = document.getElementById('satis_tarihi_field');
    const satisFiyatiInput = document.getElementById('satis_fiyati');
    const satisTarihiInput = document.getElementById('satis_tarihi');
    
    function toggleSatisFields() {
        if (durumSelect.value === 'satildi') {
            satisFiyatiField.style.display = 'block';
            satisTarihiField.style.display = 'block';
            
            // Satış tarihi boşsa bugünün tarihini set et
            if (!satisTarihiInput.value) {
                const today = new Date().toISOString().split('T')[0];
                satisTarihiInput.value = today;
            }
        } else {
            satisFiyatiField.style.display = 'none';
            satisTarihiField.style.display = 'none';
            
            // Depolandı durumunda satış bilgilerini temizle
            satisFiyatiInput.value = '';
            satisTarihiInput.value = '';
        }
    }
    
    // Sayfa yüklendiğinde kontrol et
    toggleSatisFields();
    
    // Durum değiştiğinde kontrol et
    durumSelect.addEventListener('change', toggleSatisFields);
});
</script>
{% endblock %}